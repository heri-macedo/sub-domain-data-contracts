# Databricks Asset Bundle for Data Contracts
# Reference: https://docs.databricks.com/dev-tools/bundles/index.html

bundle:
  name: my_team_contracts

# =============================================================================
# Python Resources - Dynamic job generation based on contracts
# =============================================================================

experimental:
  python:
    resources:
      - resources:load_resources

# =============================================================================
# Variables
# =============================================================================

variables:
  # Path to databricks-contracts library in Unity Catalog Volume
  CONTRACTS_WHEEL_PATH:
    description: "Path to databricks-contracts wheel in UC Volume"
    default: "/Volumes/shared/lib/wheels/databricks_contracts-0.0.0.dev0-py3-none-any.whl"

  # Service Principal for run_as (optional)
  sp_client_id:
    description: "Service Principal Client ID for run_as"
    default: ""

  # Service Principal para GRANT MODIFY (vem do CI/CD)
  workflow_sp_id:
    description: "Service Principal ID para GRANT MODIFY nas tabelas"

# =============================================================================
# Sync - Files to sync to workspace
# =============================================================================

sync:
  include:
    - data_contracts/**
    - resources/scripts/**
    - datacontract.config.yaml
  exclude:
    - "**/__pycache__/**"

# =============================================================================
# Targets (environments)
# =============================================================================

targets:
  # ---------------------------------------------------------------------------
  # Development
  # ---------------------------------------------------------------------------
  dev:
    mode: development
    default: true
    variables:
      CONTRACTS_WHEEL_PATH: "/Volumes/shared/lib/wheels/databricks_contracts-0.0.0.dev0-py3-none-any.whl"

  # ---------------------------------------------------------------------------
  # Production
  # ---------------------------------------------------------------------------
  prod:
    mode: production
    presets:
      jobs_max_concurrent_runs: 1
    workspace:
      root_path: /Workspace/.bundle/${bundle.name}/prod
    variables:
      CONTRACTS_WHEEL_PATH: "/Volumes/shared/lib/wheels/databricks_contracts-1.0.1-py3-none-any.whl"
